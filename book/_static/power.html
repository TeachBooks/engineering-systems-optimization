<!DOCTYPE html>
<html>
<head>
    <title>CO2 vs Power</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .slider {
            display: block;
            margin-bottom: 10px;
            width: 100%;
        }
        .slider-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-gap: 10px;
            width: 100%;
        }
        .output {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .output p {
            margin: 5px 0;
        }
        .output .emoji {
            font-size: 20px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div id="sliderContainer" class="slider-container"></div>
    <div id="outputContainer" class="output"></div>

    <script>
        var RPM = [800, 1000, 1200, 1400, 1700, 1800];
        var CO2 = [708, 696.889, 688.247, 682.897, 684.955, 697.3];
        var POW = [161.141, 263.243, 330.51, 381.561, 391.17, 370];

        function weighted_obj(s) {
            var delta_p = 1 / 3;
            var delta_c = 1 - delta_p;
            return -delta_p * POWfunc(s) + delta_c * CO2func(s);
        }

        var Pt = 460;
        var Ct = 640;
        function goal_attainment(s) {
            return Math.max(Pt - POWfunc(s), CO2func(s) - Ct);
        }

        function CO2func(s) {
            return numeric.spline(RPM, CO2, s);
        }

        function POWfunc(s) {
            return numeric.spline(RPM, POW, s);
        }

        function func(x, pareto_front) {
            var RPM_continuous = numeric.linspace(800, 1800, 100);
            var CO2_values = RPM_continuous.map(function(rpm) {
                return CO2func(rpm);
            });
            var POW_values = RPM_continuous.map(function(rpm) {
                return POWfunc(rpm);
            });

            var data = [
                {
                    x: CO2,
                    y: POW,
                    type: 'scatter',
                    mode: 'markers',
                    name: 'Data points'
                }
            ];

            if (pareto_front) {
                data.push({
                    x: CO2_values,
                    y: POW_values,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Pareto Front'
                });
            }

            var layout = {
                xaxis: {
                    title: 'CO2 (g/kWh)',
                    range: [680, 710]
                },
                yaxis: {
                    title: 'Power functions (kW)',
                    range: [150, 400]
                },
                showlegend: true,
                title: {
                    text: 'CO2 vs Power',
                    font: {
                        size: 16
                    }
                }
            };

            Plotly.newPlot('outputContainer', data, layout);

            var weighted_obj_val = weighted_obj(x);
            var goal_attainment_val = goal_attainment(x);

            var outputContainer = document.getElementById("outputContainer");
            outputContainer.innerHTML = "<p>Weighted üèãÔ∏è Objective: " + weighted_obj_val + "</p>" +
                "<p>Goal ü•Ö Attainment: " + goal_attainment_val + "</p>";
        }

        var sliderContainer = document.getElementById("sliderContainer");
        var xSlider = document.createElement("input");
        xSlider.type = "range";
        xSlider.min = 800;
        xSlider.max = 1800;
        xSlider.value = 1000;
        xSlider.step = 1;
        xSlider.id = "x";
        xSlider.oninput = function() {
            func(parseFloat(document.getElementById("x").value), document.getElementById("pareto_front").checked);
        };
        xSlider.classList.add("slider");

        var xLabel = document.createElement("label");
        xLabel.innerHTML = "RPM";
        xLabel.setAttribute("for", "x");
        xLabel.style.textAlign = "right";

        var paretoFrontCheckbox = document.createElement("input");
        paretoFrontCheckbox.type = "checkbox";
        paretoFrontCheckbox.checked = false;
        paretoFrontCheckbox.id = "pareto_front";
        paretoFrontCheckbox.onchange = function() {
            func(parseFloat(document.getElementById("x").value), document.getElementById("pareto_front").checked);
        };

        var paretoFrontLabel = document.createElement("label");
        paretoFrontLabel.innerHTML = "Pareto Front";
        paretoFrontLabel.setAttribute("for", "pareto_front");
        paretoFrontLabel.style.textAlign = "right";

        sliderContainer.appendChild(xLabel);
        sliderContainer.appendChild(xSlider);
        sliderContainer.appendChild(paretoFrontLabel);
        sliderContainer.appendChild(paretoFrontCheckbox);

        var outputContainer = document.getElementById("outputContainer");
        outputContainer.style.height = "400px";

        // Call func with initial values
        func(parseFloat(document.getElementById("x").value), document.getElementById("pareto_front").checked);
    </script>
</body>
</html>